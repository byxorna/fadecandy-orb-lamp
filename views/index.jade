html
  head
    script(src="//code.jquery.com/jquery-2.2.0.min.js")
    script(src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js")
    link(rel='stylesheet', href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous")
    link(rel='stylesheet' href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous")
    link(rel='stylesheet' href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/6.0.5/css/bootstrap-slider.min.css")
    script(src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous")
    script(src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/6.0.5/bootstrap-slider.min.js")
    title!= title
    style(type="text/css").
      #r_slider > .slider-track > .slider-handle {
        background: #e51c23;
      }
      #b_slider > .slider-track > .slider-handle {
        background: #0d87e9;
      }
      #g_slider > .slider-track > .slider-handle {
        background: #4caf50;
      }
  body
    div.content-area
      block content

        each ch in ['r','g','b']
          input.colorslider(type="text",name=ch,data-slider-min="0",data-slider-max="255",data-slider-step=1, data-slider-value=data[ch], data-slider-orientation="vertical")
        div(class="alert alert-success" role="alert")
        form(id='stop' method="get" action="stop")
          button(type="submit" class="btn btn-default") Stop
        form(id='pause' method="get" action="pause")
          button(type="submit" class="btn btn-default") Pause
        form(id='patterns' class="form-horizontal" method="get")
          input(type="checkbox", checked, id="run", data-toggle="switch")
          h1 Available Patterns
          ul
            each val in patterns
              li= val

    footer
      block footer
  script.
    var throttle_color_change_ms = 200;
    var data = !{JSON.stringify(data)};
    console.log("got data from server: " , data);

    function handle_color_change(evt){
      var slider = $(evt.currentTarget);
      var channel = slider.attr('name');
      //console.log("Got color change: ",channel, evt.value.newValue);
      data[channel] = evt.value.newValue;
    };
    // throttle calls to this handler
    var throttled_color_change = _.throttle(handle_color_change, throttle_color_change_ms);

    $(function(){
      $('input.colorslider').each(function(){
        var s = $(this);
        var sl = s.slider({
          id: s.attr('name') + "_slider",
          reversed: true,
          tooltip: 'hide',
        });
        sl.on('change', throttled_color_change);
      });
    });
